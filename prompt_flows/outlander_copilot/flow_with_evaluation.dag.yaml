$schema: https://azuremlschemas.azureedge.net/promptflow/latest/Flow.schema.json
environment:
  python_requirements_txt: requirements.txt
inputs:
  chat_input:
    type: string
    default: Which tent is the most waterproof?
  chat_history:
    type: list
    default: []
  ground_truth:
    type: string
    default: Alpine Explorer Tent or SkyView 2-Person Tent
outputs:
  answer:
    type: string
    reference: ${generate_response.output}
  evaluation_result:
    type: object
    reference: ${evaluate_answer.output}
nodes:
- name: search_products
  type: python
  source:
    type: code
    path: search_products.py
  inputs:
    query: ${inputs.chat_input}
  use_variants: false
- name: generate_response
  type: python
  source:
    type: code
    path: generate_response.py
  inputs:
    question: ${inputs.chat_input}
    context: ${search_products.output}
    chat_history: ${inputs.chat_history}
  use_variants: false
- name: evaluate_answer
  type: python
  source:
    type: code
    path: evaluate_answer.py
  inputs:
    question: ${inputs.chat_input}
    answer: ${generate_response.output}
    ground_truth: ${inputs.ground_truth}
    context: ${search_products.output}
  use_variants: false
